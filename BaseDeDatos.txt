-- Crear base de datos
CREATE DATABASE bdsistemaventas;
GO
USE bdsistemaventas;
GO

-- Tabla de usuarios
CREATE TABLE usuarios (
    id_usuario INT IDENTITY(1,1) PRIMARY KEY,
    nombre_usuario VARCHAR(100) NOT NULL UNIQUE,
    email_usuario VARCHAR(100) NOT NULL UNIQUE,
    contraseña_usuario VARCHAR(100) NOT NULL,
	restablecer_usuario VARCHAR(100) NOT NULL,
    rol_usuario VARCHAR(20) NOT NULL DEFAULT 'cliente',
    Estado BIT
);
GO

-- Tabla de provincias
CREATE TABLE provincias (
    id INT IDENTITY(1,1) PRIMARY KEY,
    provincia VARCHAR(255) NOT NULL,
    Estado BIT
);
GO

-- Tabla de localidades
CREATE TABLE localidades (
    id INT IDENTITY(1,1) PRIMARY KEY,
    id_provincia INT NOT NULL,
    localidad VARCHAR(255) NOT NULL,
    Estado BIT,
    FOREIGN KEY (id_provincia) REFERENCES provincias(id)
);
GO

-- Tabla de clientes
CREATE TABLE clientes (
    id_cliente INT IDENTITY(1,1) PRIMARY KEY,
    nombre_cliente VARCHAR(100),
    dni_cliente VARCHAR(45),
    apellido_cliente VARCHAR(45),
    sexo_cliente VARCHAR(45),
    fechaNacimiento_cliente DATE,
    telefono_cliente VARCHAR(20),
    direccion_cliente TEXT,
    id_usuario_cliente INT UNIQUE NULL,
    id_provincia_cliente INT NULL,
    id_localidad_cliente INT NULL,
    Estado BIT,
    FOREIGN KEY (id_usuario_cliente) REFERENCES usuarios(id_usuario) ON DELETE SET NULL,
    FOREIGN KEY (id_provincia_cliente) REFERENCES provincias(id) ON DELETE SET NULL,
    FOREIGN KEY (id_localidad_cliente) REFERENCES localidades(id) ON DELETE SET NULL
);
GO

-- Tabla de categorías
CREATE TABLE categorias (
    id_categoria INT IDENTITY(1,1) PRIMARY KEY,
    nombre_categoria VARCHAR(500) NOT NULL UNIQUE,
    Estado BIT
);
GO

-- Tabla de productos
CREATE TABLE productos (
    id_producto INT IDENTITY(1,1) PRIMARY KEY,
    nombre_producto VARCHAR(100) NOT NULL,
    descripcion_producto TEXT,
    precio_producto DECIMAL(10,2) NOT NULL,
    stock_producto INT NOT NULL,
    id_categoria_producto INT,
    id_temporada_producto INT,
    imagen_producto VARCHAR(255) NULL,
	URL_Imagen VARCHAR(255) NULL,
    Estado BIT,
    FOREIGN KEY (id_categoria_producto) REFERENCES categorias(id_categoria),
);
GO

-- Tabla de ventas
CREATE TABLE ventas (
    id_venta INT IDENTITY(1,1) PRIMARY KEY,
    id_cliente_vt INT,
    fecha_vt DATETIME DEFAULT GETDATE(),
    metodo_envio INT,
    total_vt DECIMAL(10,2) NOT NULL,
    Estado BIT,
    FOREIGN KEY (id_cliente_vt) REFERENCES clientes(id_cliente)
);
GO

-- Tabla de detalle_ventas
CREATE TABLE detalle_ventas (
    id_detalle INT IDENTITY(1,1) PRIMARY KEY,
    id_venta_dt INT,
    id_producto_dt INT,
    cantidad_dt INT NOT NULL,
    precio_unitario_dt DECIMAL(10,2) NOT NULL,
    subtotal_dt DECIMAL(10,2) NOT NULL,
    Estado BIT,
    FOREIGN KEY (id_venta_dt) REFERENCES ventas(id_venta),
    FOREIGN KEY (id_producto_dt) REFERENCES productos(id_producto)
);
GO

-- Tabla de pagos
CREATE TABLE pagos (
    id_pago INT IDENTITY(1,1) PRIMARY KEY,
    id_venta INT,
    metodo_pago INT NOT NULL,  -- 1=Tarjeta Crédito, 2=Débito, etc.
    estado VARCHAR(20) NOT NULL DEFAULT 'pendiente',
    fecha_pago DATETIME DEFAULT GETDATE(),
    total_pagado DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (id_venta) REFERENCES ventas(id_venta)
);
GO

-- Insertar provincias
INSERT INTO provincias (provincia, Estado) VALUES
('Buenos Aires', 1),
('Buenos Aires-GBA', 1),
('Capital Federal', 1),
('Catamarca', 1),
('Chaco', 1),
('Chubut', 1),
('Córdoba', 1),
('Corrientes', 1),
('Entre Ríos', 1);
GO

INSERT INTO categorias (nombre_categoria, Estado) VALUES 
('Pantalones', 1),
('Remeras', 1),
('Camisas', 1),
('Buzos', 1),
('Camperas', 1),
('Vestidos', 1);
GO

INSERT INTO usuarios (nombre_usuario, email_usuario, contraseña_usuario, restablecer_usuario, rol_usuario, estado)
VALUES ('Juan Pérez', 'juanperez@gmail.com', '1234juan','1234juan', 'admin', 1),
('María Gómez', 'mariag@gmail.com', 'maria5678','maria5678', 'vendedor', 1),
('Carlos López', 'clopez@hotmail.com', 'carlosPass','carlosPass', 'cliente', 1),
('Ana Martínez', 'ana.mtz@yahoo.com', 'ana123', 'ana123', 'cliente', 1),
('Lucía Suárez', 'luciasuarez@outlook.com', 'luciaPass99', 'luciaPass99','vendedor', 1);
GO

INSERT INTO productos (
    nombre_producto,
    descripcion_producto,
    precio_producto,
    stock_producto,
    id_categoria_producto,
    id_temporada_producto,
    imagen_producto,
    URL_Imagen,
    Estado
) VALUES 
('Pantalón cargo beige', 'Pantalón de algodón con bolsillos laterales', 15999.99, 20, 1, NULL, NULL, 'https://via.placeholder.com/300x400?text=Pantalon', 1),
('Remera oversize blanca', 'Remera suelta, algodón 100%', 7999.50, 35, 2, NULL, NULL, 'https://via.placeholder.com/300x400?text=Remera', 1),
('Camisa de lino celeste', 'Camisa liviana ideal para verano', 12450.00, 15, 3, NULL, NULL, 'https://via.placeholder.com/300x400?text=Camisa', 1),
('Buzo canguro negro', 'Buzo con capucha y bolsillo delantero', 18900.75, 10, 4, NULL, NULL, 'https://via.placeholder.com/300x400?text=Buzo', 1),
('Campera inflable', 'Campera térmica para invierno', 24999.99, 8, 5, NULL, NULL, 'https://via.placeholder.com/300x400?text=Campera', 1);

SELECT p.id_producto, p.nombre_producto, p.descripcion_producto, p.precio_producto, p.stock_producto,c.id_categoria ,c.nombre_categoria, p.id_temporada_producto, p.imagen_producto, p.URL_Imagen, p.Estado FROM Productos p
INNER JOIN categorias c ON c.id_categoria = p.id_categoria_producto
